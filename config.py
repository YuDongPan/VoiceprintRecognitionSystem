# ===== 屏蔽警告信息（全局生效）=====
import os
import pyaudio

os.environ['PYTHONWARNINGS'] = 'ignore::UserWarning,ignore::libpng warning'
import warnings

warnings.filterwarnings("ignore", message="Module 'speechbrain.pretrained' was deprecated")

# ===== 文本素材常量 =====
# 训练文本素材（无编号+扩充至20条，主题涵盖生活、健康、技术、自然等，适配声纹采集）
TRAIN_TEXT_MATERIALS = [
    "今天天气晴朗，适合户外散步或开窗通风。（约 4 秒）",
    "声纹识别技术正在越来越多的场景中应用。（约 5 秒）",
    "数字密码容易忘记，声纹验证更加安全便捷。（约 5 秒）",
    "早晨喝一杯温水，对身体代谢很有帮助。（约 4 秒）",
    "周末计划去图书馆看书，或者在家整理房间。（约 5 秒）",
    "语音是每个人独特的生物特征，难以复制。（约 4 秒）",
    "请保持自然语速朗读，无需刻意放慢或加快。（约 5 秒）",
    "智能设备的声纹解锁功能，让使用更高效。（约 4 秒）",
    "春天的花开得真好看，空气里都是青草香。（约 4 秒）",
    "验证码已经发送到你的手机，请及时查看。（约 4 秒）",
    "坚持每天锻炼半小时，能够有效提升免疫力。（约 5 秒）",
    "声纹识别具有唯一性，不会与他人产生混淆。（约 4 秒）",
    "傍晚的晚霞染红了天空，景色十分迷人。（约 4 秒）",
    "办公时保持正确坐姿，可减少颈椎腰椎负担。（约 5 秒）",
    "移动支付的安全验证，声纹技术发挥重要作用。（约 5 秒）",
    "睡前泡个热水脚，有助于提高睡眠质量。（约 4 秒）",
    "城市的夜景灯火通明，展现着别样的繁华。（约 4 秒）",
    "声纹建模需要清晰的语音，避免背景噪音干扰。（约 5 秒）",
    "夏日的夜晚微风习习，适合在户外乘凉聊天。（约 4 秒）",
    "在线业务办理中，声纹验证可简化身份核对流程。（约 5 秒）"
]

# 测试文本素材（无编号+扩充至18条，格式、时长、主题与训练文本完全对齐，无内容重叠）
TEST_TEXT_MATERIALS = [
    "人工智能发展迅速，正在改变我们的生活方式。（约 4 秒）",
    "随着技术迭代，声纹识别的准确率越来越高了。（约 5 秒）",
    "办理业务时，请说出你的姓名和身份证号。（约 4 秒）",
    "收到通知，今天的会议将在下午三点开始。（约 4 秒）",
    "账号安全提醒，密码已重置，请及时登录修改。（约 5 秒）",
    "声纹验证无需手动操作，使用起来十分便捷。（约 4 秒）",
    "下班之后，计划去超市买菜或者回家做晚饭。（约 5 秒）",
    "秋日的阳光很温暖，微风里带着桂花的香气。（约 4 秒）",
    "大数据技术的普及，推动了智能识别的发展。（约 4 秒）",
    "手机丢失后，声纹锁可防止他人非法使用设备。（约 5 秒）",
    "清晨的公园很热闹，有很多人在晨练健身。（约 4 秒）",
    "网络安全至关重要，声纹验证提供额外保障。（约 5 秒）",
    "冬日的雪花漫天飞舞，给大地披上白色外衣。（约 4 秒）",
    "预定的快递已发出，预计明天上午可以送达。（约 4 秒）",
    "声纹识别不受光线影响，夜间也能正常使用。（约 5 秒）",
    "周末和朋友相约爬山，既能锻炼又能欣赏风景。（约 4 秒）",
    "银行办理信贷业务，声纹验证可提高审核效率。（约 5 秒）",
    "雨后的空气格外清新，带着泥土的湿润气息。（约 4 秒）"
]

# ===== 全局路径常量 =====
# 数据集根目录
DATASET_ROOT = "./voice_dataset"
# 自动创建数据集目录
os.makedirs(DATASET_ROOT, exist_ok=True)

# ===== 模型默认参数 =====
SAMPLE_RATE = 16000  # 音频采样率
CHANNELS = 1  # 单声道
RECORD_FORMAT = pyaudio.paInt16  # 音频采样格式（先占位，实际使用时导入pyaudio）

# ========== ECAPA算法 阈值相关 ==========
ECAPA_DEFAULT_THRESHOLD_NUM_EMBEDS = 5  # 注册音频数量少于5个时，采用默认阈值
ECAPA_DEFAULT_THRESHOLD = 0.66    # ECAPA算法默认阈值
ECAPA_THRESHOLD_STD_COEF = 2.5  # α，核心调节参数，越大越宽松
ECAPA_THRESHOLD_MIN = 0.55  # 下限保护
ECAPA_THRESHOLD_MAX = 0.80  # 上限保护（可选）

# ========== ECAPA算法 音频质量 ==========
ECAPA_MIN_DURATION = 3.0  # 秒（<3s 不建议用于建模）
ECAPA_MIN_RMS = 1e-4  # 经验值，防止静音/远场

# ========== SHERPA算法 阈值相关 ==========
SHERPA_DEFAULT_THRESHOLD_NUM_EMBEDS = 5  # 注册音频数量少于5个时，采用默认阈值
SHERPA_DEFAULT_THRESHOLD = 0.76    # SHERPA算法默认阈值
SHERPA_EMA_ALPHA = 0.02  # 非常保守
SHERPA_UPDATE_MARGIN = 0.05  # 必须明显高于阈值才更新
SHERPA_THRESHOLD_MIN = 0.45
SHERPA_THRESHOLD_MAX = 0.80

SHERPA_VAD_MIN_SPEECH_DURATION = 0.1  # 可以尝试0.05-0.2
SHERPA_VAD_MIN_SILENCE_DURATION = 0.1  # 可以尝试0.1-0.3
SHERPA_VAD_THRESHOLD = 0.5  # 默认0.5，可尝试0.3-0.7
